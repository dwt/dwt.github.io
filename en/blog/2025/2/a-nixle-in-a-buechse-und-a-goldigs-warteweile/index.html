
<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../../../../../static/bootstrap-4.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../../../static/style.css">
    <link rel="stylesheet" href="../../../../../static/pygments.css">
    <title>A Nix&#39;le in a B√ºchse und a goldigs Warteweile</title>
    <link rel="alternate" type="application/atom+xml" title="RSS: Martin H√§ckers Blog Artikel" href="../../../../../blog/feed.xml" />
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand-sm">
  <a href="../../../../" class="navbar-brand ">üè†</a>
  <input type="checkbox" id="navbar-toggle-checkbox">
  <label for="navbar-toggle-checkbox" class="navbar-brand navbar-toggle d-sm-none float-right" aria-label="Navigation Umschalten">
    <span></span>
  </label>
  <ul class="navbar-nav collapse navbar-collapse">
    
      <li class="nav-item "><a href="../../../../work/" class="nav-link">Professional software development</a></li>
    
      <li class="nav-item "><a href="../../../../projects/" class="nav-link">Projects</a></li>
    
      <li class="nav-item "><a href="../../../../publications/" class="nav-link">Publications and talks</a></li>
    
      <li class="nav-item active"><a href="../../../" class="nav-link">Blog<span class="sr-only">(ausgew√§hlt)</span></a></li>
    
      <li class="nav-item "><a href="../../../../categories/" class="nav-link">Categories</a></li>
    
    <li class="nav-item ml-auto">
      <a class=nav-link href="../../../../../blog/2025/2/a-nixle-in-a-buechse-und-a-goldigs-warteweile/">üá©üá™</a>
    </li>
    <li class="nav-item pull-right">
      <a class=nav-link href="./">üá¨üáß</a>
    </li>
  </ul>
</nav>
<nav class="breadcrumb">
  

  

  

<a class="breadcrumb-item " href="../../../../">üè†</a>


<a class="breadcrumb-item " href="../../../">Blog</a>


<a class="breadcrumb-item active" href="./">A Nix&#39;le in a B√ºchse und a goldigs Warteweile</a>

</nav>
    </header>
    <article class="page a-nixle-in-a-buechse-und-a-goldigs-warteweile  container-fluid">
      
  
  <article class="blog-post">
    <header>
      <h2>
        
        A Nix&#39;le in a B√ºchse und a goldigs Warteweile
        
      </h2>
      <p class="meta">
        written by Martin H√§cker on <time datetime="2025-02-08">Saturday, February 8, 2025</time>
      </p>
    </header>

    <section class="blog-post-body">
      <p><img src="nix-rabbit-hole.png" alt="Das Nix Hasenloch">
‚Ä¶ ist ein schw√§bisches Sprichwort und passt gar nicht so schlecht f√ºr die vielen schlechten Wortwitze die sich automatisch ergeben, wenn man anf√§ngt, sich in das <a href="https://nix.dev">Nix Projekt</a> einzuarbeiten.</p>
<p>Zun√§chst mal die Karotte mit der ich mich k√∂dern lie√ü:</p>
<ul>
<li>Deklarative Konfiguration von Software-Builds, System-Konfigurationen, und wenn man m√∂chte auch Deployments z.B. in Kubernetes und was man sonst gerne m√∂chte</li>
<li>Ein funktionaler Paket-Manager, das hei√üt: Jede Software kann ihre eigenen Abh√§ngigkeiten in der passenden Version haben. Wenn ich mal ein Tool in der Version von vor 10 Jahren brauche - einfach zus√§tzlich installieren, ohne dass dadurch etwas gest√∂rt wird. Wenn ich mal eine neuere Version von etwas brauche als die aktuelle Distribution anbietet: Einfach installieren, ohne dass dadurch etwas gest√∂rt wird.</li>
<li>Rollback: Systemkonfiguration hat etwas kaputt gemacht? Einfach R√ºckg√§ngig machen.</li>
<li>Update auf eine neue Version des Betriebssystems: Man kriegt fehlermeldungen f√ºr alle Konfigurationen die man vorgenommen hat die jetzt umbenannt wurden oder anders funktionieren. ü§Ø</li>
<li>Reproduzierbarkeit: Vollst√§ndige Erfassung der Inputs und Ablegen derselben in einem Lock-File.</li>
<li>Eine riesige Community, die beste Praktiken zum Betrieb von Linux (und mehr) Systemen <a href="https://repology.org/repositories/statistics/total">in die gr√∂√üte Software-Bibliothek kodiert, die wir bisher gesehen haben.</a></li>
</ul>
<p>Was sollte man da nicht m√∂gen?</p>
<p>Auf MacOs gibt es mit <a href="https://github.com/LnL7/nix-darwin">nix-darwin</a> ein Projekt mit dem man die System-Konfiguration deklarativ vornehmen kann - und auch <a href="https://brew.sh">homebrew</a> (was sonst so gut wie gar nicht reproduzierbar ist) unter Kontrolle kriegt. Und wenn man m√∂chte, verwaltet es einem auch die dotfiles.</p>
<p>Es gibt allerdings einen gewaltigen Nachteil: Das Ganze ist echt komplex und kompliziert. Und die Dokumentation ist nicht schlecht, aber k√∂nnte deutlich besser sein.</p>
<p>Wenn man diese H√ºrde √ºberwindet, wird man mit einer erstaunlich kompakten und sehr schnell anzuwendenden System-Konfiguration belohnt. Damit kann man zum Beispiel auf einem Mac ein vollst√§ndig konfiguriertes System-Image f√ºr einen Raspberry Pi erstellen. Dann noch flaschen, starten und l√§uft! Oder auf meinem Mac Bauen, und via ssh auf dem RasPi deployen, ohne dort irgendwas zu machen was dessen CPU stresst.</p>
<p>Ich habe inzwischen angefangen, meine Rechner damit zu verwalten und konfigurieren.</p>
<ul>
<li><a href="https://github.com/dwt/nix-darwin-config">Mein Rechner (nix-darwin)</a></li>
<li><a href="https://github.com/dwt/home-servers">Mein Homelab (nixos)</a></li>
<li><a href="https://github.com/dwt/home-automation">Meine Heimautomatisierung (python)</a></li>
</ul>
<h1>Nix ist vielleicht nichts f√ºr dich‚Ä¶</h1>
<p>‚Ä¶ aber wenn Du ein bisschen nerdig bist, und gerne auf der Kommandozeile lebst, infrastruktur as Code magst oder lernen magst und DevOps f√ºr dich eh normal ist. Dann k√∂nnte Nix auch f√ºr dich genau das richtige sein.</p>
<h1>Wie lernt man Nix am besten?</h1>
<p>Was mir beim Lernen von Nix gefehlt hat, w√§re eine Leitlinie gewesen, in welcher Reihenfolge ich mich an die vielen Features von Nix heran tasten sollte. Eine Reihenfolge, die sicherstellt, das die Lernkurve zu jedem Zeitpunkt ertr√§glich bleibt. Und besonders wichtig: Die Sicherstellt, das zu jedem Zeitpunkt sichtbar ist wie cool und wertvoll diese Technologie ist. Sonst l√§uft man Gefahr, ob der steilen Lernkurve abzuspringen.</p>
<p>Das h√§tte ich gerne gehabt: Wenn du anf√§ngst Nix zu lernen, dann am besten in dieser Reihenfolge:</p>
<h2>1. Schritt: Installieren, ohne was bestehendes kaputt zu machen</h2>
<p>Zuerst sollte man Nix neben dem aktuellen OS installieren. Der Standard ist der <a href="https://docs.determinate.systems/getting-started/individuals/">Determinate Installer</a>, aber ich mag <a href="https://lix.systems">das Lix Projekt lieber, da es schneller ist</a>. Alternativ ist auch <a href="https://nixos.org/download/#nix-install-docker">der Nix-Docker-Container super um es mal auszuprobieren</a>. Wenn man m√∂chte, <a href="https://nixos.org/download/#nix-install-linux">kann man Nix (auf Linux) auch einfach in einen Ordner installieren und so verwenden (siehe "Single-User Mode")</a>. Das w√ºrde ich aber nur f√ºr ein paar Experimente empfehlen. Sowohl der Determinate als auch der Lix-Installer haben sehr gute Uninstaller die das Projekt auch wieder komplett entfernen k√∂nnen.</p>
<h2>2. Schritt: Imperativ verwenden</h2>
<p>Nix erlaubt es jederzeit ein Paket zu benutzen, ohne es zu installieren. Das ist eine Konsequenz davon wie der Paket-Manager aufgebaut ist. Ein Paket kann 'im <code>/nix/store/</code> sein' - ohne das es aktiv ist. Und der Befehl <code>nix run nixpkgs#fzf</code> startet es dann einfach - ohne es zu installieren. Alternativ gibt es auch <code>nix shell nixpkgs#fzf</code>. Damit erh√§llt man eine Shell, in der <code>fzf</code> installiert ist. Schlie√üt man die Shell, ist es auch wieder weg. üò≥</p>
<p>Dass ist der Hammer, weil man so Pakete ohne Reue ausprobieren kann. Ohne Sorgen, dass doch noch irgendwelche Abh√§ngigkeiten evtl. auf dem System herum gurken und man vergessen k√∂nnte ein Experiment wieder zu entfernen. Und das beste: Auch sp√§ter wird man dieses Feature die ganze Zeit verwenden.</p>
<p>Vorsicht vor <code>nix-env</code> und <code>nix profile</code> - das ist das √Ñquivalent zu dem wie man mit <code>homebrew</code>  und anderen Paketmanagern Pakete installieren w√ºrde. Diese sollte man so selten wie m√∂glich verwenden. Besser ist‚Ä¶</p>
<h2>3. Schritt: Entwicklungsumgebungen <code>shell.nix</code></h2>
<p>Das, was <code>nix shell nixpkgs#fzf</code> macht, kann man auch in eine Datei schreiben, und damit einfach in ein Repo mit einchecken. Schon hat man Deklarativ die ganzen Tools im Repo dokumentiert, die man braucht um mit einem Projekt zu arbeiten. Bonus: Ich kann f√ºr jedes Projekt eigene Versionen der Abh√§ngigkeiten haben (wenn ich das brauche). Python-Virtual-Envs auf Steroiden!</p>
<p>Hier ein Beispiel:</p>
<div class="hll"><pre><span></span><span class="p">{</span>
  pkgs <span class="o">?</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{</span> <span class="p">},</span>
<span class="p">}:</span>
pkgs<span class="o">.</span>mkShell <span class="p">{</span>
  <span class="ss">buildInputs</span> <span class="o">=</span> <span class="k">with</span> pkgs<span class="p">;</span> <span class="p">[</span>
    <span class="c1"># Add your build inputs here</span>
    pkgs<span class="o">.</span>python313
    pkgs<span class="o">.</span>uv
  <span class="p">];</span>
  <span class="ss">env</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">UV_PYTHON</span> <span class="o">=</span> pkgs<span class="o">.</span>python313<span class="p">;</span>
    <span class="ss">UV_DOWNLOAD_PYTHON</span> <span class="o">=</span> <span class="s2">&quot;never&quot;</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</pre></div>
<p>Wenn man das mit <code>nix-shell</code> aufruft, dann hat man diese Python-Version zur Hand. <code>uv</code> verwendet diese und l√§dt selber keine Python-Versionen herunter. Nice! Extra nice: mit <code>nix-shell --pure</code>  hat man eine Shell in der <em>nur</em> das sichtbar ist was in dem <code>shell.nix</code> steht, und man kriegt Fehler f√ºr alles was man verwendet und in der <code>shell.nix</code> vergessen hat. ü§Ø</p>
<p>Bonus: <a href="https://direnv.net">Direnv</a> verwenden um automatisch die <code>shell.nix</code> und das <code>.env</code> zu laden. Dazu <a href="https://github.com/ajeetdsouza/zoxide">zoxide</a> um schnell in der Shell zwischen vielen Projekten hin und zu springen. Eine richtig geniale Entwicklungsumgebung.</p>
<p>Ich empfehle erst mal eine weile auf diesem Niveau zu bleiben, denn das ist schon ziemlich cool!</p>
<h2>4. Schritt: Mehr Tooling um besser mit Nix klar zu kommen</h2>
<ul>
<li>Pakete findet man am besten √ºber <a href="https://search.nixos.org/packages">die Webseite search.nixos.org</a> - aber ich mag eigentlich in der shell suchen. <code>nix run nixpkgs#nh search ut1999</code> funktioniert besser als alles was ich sonst bisher getestet habe.</li>
<li>Anzeigen was gerade installiert ist und wieso ist aufgrund der Architektur von nix gar nicht so einfach. <code>nix run nixpkgs#nix-tree</code> aproximiert das und gibt einen guten √ºberblick dar√ºber was man auf dem System hat.</li>
<li><code>nom</code> - der <a href="https://github.com/maralorn/nix-output-monitor">Nix-Output-Monitor</a> <code>nix run nixpkgs#nix-output-monitor</code> macht den output von l√§ngeren nix builds viel informativer und spannender. Verwenden kann man das so: <code>nix run $something |&amp; nix run nixpkgs#nix-output-monitor</code></li>
<li><code>nix store gc</code> um alles zu l√∂schen, was man mal testweise runtergeladen hat und nicht mehr auf der Platte braucht. (Einer Der Nachteile von Nix: Es verbraucht schnell <em>viel</em> Plattenplatz).</li>
</ul>
<h2>5. Schritt: Tief in das Hasenloch fallen</h2>
<p>Jetzt gibt es verschiedene Sachen die man sich anschauen k√∂nnte</p>
<ul>
<li><a href="https://nix.dev/manual/nix/2.24/language/index.html">Die Nix Sprache lernen</a> - die Voraussetzung f√ºr fast alles was danach kommt, also gut investierte Zeit. Und es ist eine wirklich kleine Sprache - auch wenn <a href="https://github.com/NixOS/nixpkgs">die 'Standard-Bibliothek' (meiner Meinung nach das NixPKGs Repository)</a> alles andere als klein ist.</li>
<li><a href="https://devenv.sh">devenv</a> um Entwicklungsumgebungen kurz und Knackig und mit allen Features deklarativ zu beschreiben und ins Projekt eingecheckt zu bekommen.</li>
<li><a href="https://nixos-and-flakes.thiscute.world">Flakes - der Standard in der Nix-Community, mit der Abh√§ngigkeits-Versionen festgeschrieben werden</a>. Also wie checke ich die genauen git commit hashes die ich verwendet habe um alle meine Software zu bauen ins Repo mit ein. Damit kann man ein Projekt auch nach Jahren sehr einfach verl√§sslich wieder bauen.</li>
<li><a href="https://github.com/pyproject-nix/uv2nix">uv2nix - wie man Python-Projekte Nix-ifiziert</a></li>
<li><a href="https://github.com/LnL7/nix-darwin">nix-darwin</a> um ein MacOS System so deklarativ zu verwalten, wie das unter NixOS geht. (OK, Apple setzt da grenzen, aber das ist trotzdem sehr cool).</li>
<li><a href="https://nix-community.github.io/home-manager/">home-manager</a> um dotfiles zu verwalten und auf Benutzer-Ebene alles zu konfigurieren.</li>
<li>Quasi alles von <a href="https://github.com/nix-community/awesome-nix?tab=readme-ov-file">Awesome-Nix</a>.</li>
<li>Und so viele Projekte mehr, die man sich anschauen k√∂nnte‚Ä¶</li>
</ul>

    </section>
    
  </article>

  <nav>
    
  <div class="category-list">
    Kategorien:
      
      <a href="../../../../../categories/code/">Software Development</a>
      , 
    
      
      <a href="../../../../../categories/project/">Projekte</a>
      
    
  </div>

    
    <div class="relative-navigation">
      
        <div class="prev">Vorheriges Post: <a class="prev" href="../die-freuden-einer-gut-eingerichteten-shell-prompt/">Die Freuden einer gut eingerichteten Shell: Der Prompt</a></div>
      
      
        <div class="next">N√§chstes Post: <a class="next" href="../../../2024/11/grundlegende-funktionen-und-einstellungen-des-terminals/">Grundlegende Funktionen und Einstellungen des Terminals</a></div>
      
    </div>
    
  </nav>

    </article>
    <footer class="container-fluid ">
      <ul class="nav">
  <li class="nav-item copyright">
    <span class="nav-link">&copy; 2025 <a href="../../../../work/">Martin H√§cker</a></span>
  </li>
  
    
    <li class="nav-item imprint">
      <a class="nav-link" href="../../../../meta/#imprint">
        Imprint
      </a></li>
  
    
    <li class="nav-item privacy-policy">
      <a class="nav-link" href="../../../../meta/#privacy-policy">
        Privacy Policy
      </a></li>
  
    
    <li class="nav-item colophon">
      <a class="nav-link" href="../../../../meta/#colophon">
        Colophon
      </a></li>
  
  <li class="ml-auto nav-item rss-feed">
    <a class="nav-link" href="../../../../../blog/feed.xml">
      <img class="rss-icon" src=/static/rss.svg height=25 width=25>
      <span class="sr-only">RSS-Feed</span>
    </a>
  </li>
  <li class="nav-item license">
    <a class="nav-link" 
      rel="license" 
      target="_blank" 
      href="https://creativecommons.org/licenses/by-sa/4.0/deed"
    >
      <img 
        src="/static/cc-by-sa-88x31.png"
        alt="Creative Commons Attribution - Share Alike 4.0 International Lizense"
      >
    </a>
  </li>
</ul>
    </footer>
  </body>
</html>
